<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>holtz.apogee.elem &mdash; apogee 0.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="apogee 0.0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">apogee 0.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for holtz.apogee.elem</h1><div class="highlight"><pre>
<span></span><span class="c1"># makes a bunch of [X/Fe] vs [Fe/H] plots for use with calibration</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sdss.apogee</span> <span class="kn">import</span> <span class="n">apload</span>
<span class="kn">from</span> <span class="nn">sdss.apogee</span> <span class="kn">import</span> <span class="n">apselect</span>
<span class="kn">from</span> <span class="nn">holtz.tools</span> <span class="kn">import</span> <span class="n">plots</span>
<span class="kn">from</span> <span class="nn">holtz.tools</span> <span class="kn">import</span> <span class="n">html</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">ascii</span>
<span class="kn">import</span> <span class="nn">esutil</span>

<span class="nb">reload</span><span class="p">(</span><span class="n">apselect</span><span class="p">)</span>
<span class="c1">#reload(galmodel)</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">plots</span><span class="p">)</span>

<div class="viewcode-block" id="read"><a class="viewcode-back" href="../../../elem.html#holtz.apogee.elem.read">[docs]</a><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;allStar-testcal.fits&#39;</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Read allStar file</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">apload</span><span class="o">.</span><span class="n">dr13</span><span class="p">()</span>
    <span class="c1">#a=apload.allStar()[1].data</span>
    <span class="n">c</span><span class="o">=</span><span class="n">apload</span><span class="o">.</span><span class="n">allStar</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="c1">#a=fits.open(&#39;../dist/allStar+.fits&#39;)[1].data</span>
    <span class="c1">#x,y,z,r = galmodel.lbd2xyz(a[&#39;GLON&#39;],a[&#39;GLAT&#39;],a[&#39;DISO&#39;][:,2]/1000.)</span>
    <span class="c1">#zone=np.where((r&gt;9) &amp; (r&lt;11) &amp; (dt&lt;40))[0]</span>

    <span class="n">a</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">file</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="c1">#c=fits.open(file)[3].data</span>
    <span class="n">elem</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;ELEM_SYMBOL&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">elemtoh</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;ELEMTOH&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">elem</span><span class="p">,</span> <span class="n">elemtoh</span>
</div>
<div class="viewcode-block" id="arctabun"><a class="viewcode-back" href="../../../elem.html#holtz.apogee.elem.arctabun">[docs]</a><span class="k">def</span> <span class="nf">arctabun</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Define Arcturus abundances, and return requested abundance</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">abun</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;C&quot;</span> <span class="p">:</span> <span class="mf">0.090000</span><span class="p">,</span> <span class="s2">&quot;CI&quot;</span> <span class="p">:</span> <span class="mf">0.09</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span> <span class="p">:</span> <span class="mf">0.400000</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span> <span class="p">:</span> <span class="mf">0.480000</span><span class="p">,</span> <span class="s2">&quot;Na&quot;</span> <span class="p">:</span> <span class="mf">0.210000</span><span class="p">,</span> <span class="s2">&quot;Mg&quot;</span> <span class="p">:</span> <span class="mf">0.370000</span><span class="p">,</span> <span class="s2">&quot;Al&quot;</span> <span class="p">:</span> <span class="mf">0.400000</span><span class="p">,</span> <span class="s2">&quot;Si&quot;</span> <span class="p">:</span> <span class="mf">0.330000</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span> <span class="p">:</span> <span class="mf">0.070000</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span> <span class="p">:</span> <span class="mf">0.350000</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span> <span class="p">:</span> <span class="mf">0.200000</span><span class="p">,</span> <span class="s2">&quot;Ca&quot;</span> <span class="p">:</span> <span class="mf">0.090000</span><span class="p">,</span> <span class="s2">&quot;Sc&quot;</span> <span class="p">:</span> <span class="mf">0.070000</span><span class="p">,</span> <span class="s2">&quot;Ti&quot;</span> <span class="p">:</span> <span class="mf">0.250000</span><span class="p">,</span> <span class="s2">&quot;TiII&quot;</span> <span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span> <span class="p">:</span> <span class="mf">0.160000</span><span class="p">,</span> <span class="s2">&quot;Cr&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.050000</span><span class="p">,</span> <span class="s2">&quot;Mn&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.120000</span><span class="p">,</span> <span class="s2">&quot;Fe&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.000000</span><span class="p">,</span> <span class="s2">&quot;Co&quot;</span> <span class="p">:</span> <span class="mf">0.040000</span><span class="p">,</span> <span class="s2">&quot;Ni&quot;</span> <span class="p">:</span> <span class="mf">0.030000</span><span class="p">,</span> <span class="s2">&quot;Cu&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.050000</span><span class="p">,</span> <span class="s2">&quot;Ge&quot;</span> <span class="p">:</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="s2">&quot;Rb&quot;</span> <span class="p">:</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span> <span class="p">:</span> <span class="mf">0.000000</span><span class="p">,</span> <span class="s2">&quot;Ce&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.190000</span><span class="p">,</span> <span class="s2">&quot;Nd&quot;</span> <span class="p">:</span> <span class="mf">0.130000</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span> <span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span> <span class="p">:</span> <span class="mf">0.3</span><span class="p">}</span>
    <span class="k">return</span><span class="p">(</span><span class="n">abun</span><span class="p">[</span><span class="n">el</span><span class="p">])</span> 
</div>
<div class="viewcode-block" id="optabun"><a class="viewcode-back" href="../../../elem.html#holtz.apogee.elem.optabun">[docs]</a><span class="k">def</span> <span class="nf">optabun</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    ??? define abundance offsets from some optical analysis ???</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">abun</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Na&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">,</span> <span class="s2">&quot;Mg&quot;</span> <span class="p">:</span>  <span class="mf">0.06</span><span class="p">,</span> <span class="s2">&quot;Al&quot;</span> <span class="p">:</span>  <span class="mf">0.04</span><span class="p">,</span> <span class="s2">&quot;Si&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.21</span><span class="p">,</span> <span class="s2">&quot;Ca&quot;</span> <span class="p">:</span>  <span class="mf">0.11</span><span class="p">,</span> <span class="s2">&quot;Ti&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.14</span><span class="p">,</span> <span class="s2">&quot;TiII&quot;</span> <span class="p">:</span> <span class="mf">0.08</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">,</span> <span class="s2">&quot;Cr&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.04</span><span class="p">,</span> <span class="s2">&quot;Mn&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.36</span><span class="p">,</span> <span class="s2">&quot;Fe&quot;</span> <span class="p">:</span> <span class="mf">0.06</span><span class="p">,</span> <span class="s2">&quot;Co&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.26</span><span class="p">}</span>
    <span class="k">try</span> <span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">abun</span><span class="p">[</span><span class="n">el</span><span class="p">])</span> 
    <span class="k">except</span> <span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="o">-</span><span class="mf">9999.</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="refabun"><a class="viewcode-back" href="../../../elem.html#holtz.apogee.elem.refabun">[docs]</a><span class="k">def</span> <span class="nf">refabun</span><span class="p">(</span><span class="n">el</span><span class="p">,</span><span class="n">dwarf</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="p">:</span>
   <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">   Return reference abundance: 0 if giant,  Arcturus if not?</span>
<span class="sd">   &#39;&#39;&#39;</span>
   <span class="k">if</span> <span class="n">dwarf</span> <span class="p">:</span>
       <span class="k">return</span> <span class="mf">0.</span>
   <span class="k">else</span> <span class="p">:</span>
       <span class="k">return</span> <span class="n">arctabun</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="plot"><a class="viewcode-back" href="../../../elem.html#holtz.apogee.elem.plot">[docs]</a><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">elem</span><span class="p">,</span><span class="n">etoh</span><span class="p">,</span><span class="n">dwarf</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">gcal</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">dcal</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">glon</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">glat</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">usemh</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">sn</span><span class="o">=</span><span class="p">[</span><span class="mi">200</span><span class="p">,</span><span class="mi">1000</span><span class="p">])</span> <span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Make a bunch of plots</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># selection</span>
    <span class="c1">#dt=a[&#39;FPARAM&#39;][:,0]-(4468+(a[&#39;FPARAM&#39;][:,1]-2.5)/0.0018 - 382.5*a[&#39;FPARAM&#39;][:,3])</span>
    <span class="c1">#gd=apselect.select(a[zone],badval=&#39;STAR_BAD&#39;,logg=[-1,3.5],sn=[200,1000],teff=[4000,4800])</span>
    <span class="c1">#gd=zone[gd]</span>
    <span class="k">if</span> <span class="n">dwarf</span> <span class="p">:</span>
        <span class="n">tit</span> <span class="o">=</span> <span class="s1">&#39;Dwarfs, S/N&gt;200&#39;</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;d&#39;</span><span class="o">+</span><span class="n">suffix</span>
        <span class="n">tmax</span><span class="o">=</span><span class="mi">6500</span>
        <span class="n">gd</span><span class="o">=</span><span class="n">apselect</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">badval</span><span class="o">=</span><span class="s1">&#39;STAR_BAD&#39;</span><span class="p">,</span><span class="n">sn</span><span class="o">=</span><span class="n">sn</span><span class="p">,</span><span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">glon</span><span class="o">=</span><span class="n">glon</span><span class="p">,</span><span class="n">glat</span><span class="o">=</span><span class="n">glat</span><span class="p">,</span><span class="n">dwarfs</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">etoh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">etoh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">etoh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">ref</span><span class="o">=</span><span class="n">apselect</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">redid</span><span class="o">=</span><span class="s1">&#39;VESTA&#39;</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">tit</span> <span class="o">=</span> <span class="s1">&#39;Giants, S/N&gt;200&#39;</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="o">+</span><span class="n">suffix</span>
        <span class="n">tmax</span><span class="o">=</span><span class="mi">6500</span>
        <span class="n">gd</span><span class="o">=</span><span class="n">apselect</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">badval</span><span class="o">=</span><span class="s1">&#39;STAR_BAD&#39;</span><span class="p">,</span><span class="n">sn</span><span class="o">=</span><span class="n">sn</span><span class="p">,</span><span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">glon</span><span class="o">=</span><span class="n">glon</span><span class="p">,</span><span class="n">glat</span><span class="o">=</span><span class="n">glat</span><span class="p">,</span><span class="n">giants</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">ref</span><span class="o">=</span><span class="n">apselect</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">redid</span><span class="o">=</span><span class="s1">&#39;alpha_Boo&#39;</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;elem/&#39;</span><span class="o">+</span><span class="n">prefix</span><span class="o">+</span><span class="s1">&#39;.dat&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>


    <span class="c1"># get the indices for different grids, and for stars near solar metallicity</span>
    <span class="n">fgrid</span><span class="o">=</span><span class="n">apselect</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">gd</span><span class="p">],</span><span class="n">grid</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">gkgrid</span><span class="o">=</span><span class="n">apselect</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">gd</span><span class="p">],</span><span class="n">grid</span><span class="o">=</span><span class="s1">&#39;GK&#39;</span><span class="p">,</span><span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">mgrid</span><span class="o">=</span><span class="n">apselect</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">gd</span><span class="p">],</span><span class="n">grid</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">solar</span><span class="o">=</span><span class="n">apselect</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">gd</span><span class="p">],</span><span class="n">mh</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">],</span><span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">ifeh</span><span class="o">=</span><span class="mi">17</span>
    <span class="n">ytit</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">files</span><span class="o">=</span><span class="p">[]</span>
    <span class="c1"># loop over elements</span>
    <span class="n">nelem</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ielem</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nelem</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">file</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="n">ielem</span> <span class="o">&lt;</span> <span class="n">nelem</span> <span class="p">:</span>
            <span class="n">el</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="n">ielem</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c1">#eelem = a[&#39;ELEM&#39;][gd,ielem]</span>
            <span class="n">eelem</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;X_M&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="n">ielem</span><span class="p">]</span>
            <span class="n">felem</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FELEM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="n">ielem</span><span class="p">]</span>
            <span class="n">eelem_err</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;X_M_ERR&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="n">ielem</span><span class="p">]</span>
            <span class="n">felem_err</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FELEM_ERR&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="n">ielem</span><span class="p">]</span>
            <span class="n">tmp</span><span class="o">=</span><span class="n">etoh</span><span class="p">[</span><span class="n">ielem</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ielem</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">usemh</span> <span class="ow">and</span> <span class="n">etoh</span><span class="p">[</span><span class="n">ielem</span><span class="p">]</span> <span class="p">:</span>
                    <span class="c1">#eelem -= a[&#39;FPARAM&#39;][gd,3]</span>
                    <span class="n">felem</span> <span class="o">-=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">usemh</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">etoh</span><span class="p">[</span><span class="n">ielem</span><span class="p">]</span> <span class="p">:</span>
                    <span class="c1">#eelem += a[&#39;FPARAM&#39;][gd,3]</span>
                    <span class="n">felem</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">giants</span> <span class="o">=</span> <span class="n">apselect</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">gd</span><span class="p">],</span><span class="n">grid</span><span class="o">=</span><span class="s1">&#39;g_&#39;</span><span class="p">,</span><span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">usemh</span> <span class="p">:</span>
                    <span class="c1">#eelem[giants] += a[&#39;FPARAM&#39;][gd[giants],3] </span>
                    <span class="n">felem</span><span class="p">[</span><span class="n">giants</span><span class="p">]</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">[</span><span class="n">giants</span><span class="p">],</span><span class="mi">3</span><span class="p">]</span> 
                <span class="n">dwarfs</span> <span class="o">=</span> <span class="n">apselect</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">gd</span><span class="p">],</span><span class="n">grid</span><span class="o">=</span><span class="s1">&#39;d_&#39;</span><span class="p">,</span><span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">usemh</span> <span class="p">:</span>
                    <span class="c1">#eelem[dwarfs] -= a[&#39;FPARAM&#39;][gd[dwarfs],3] </span>
                    <span class="n">felem</span><span class="p">[</span><span class="n">dwarfs</span><span class="p">]</span> <span class="o">-=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">[</span><span class="n">dwarfs</span><span class="p">],</span><span class="mi">3</span><span class="p">]</span> 
        <span class="k">elif</span> <span class="n">ielem</span> <span class="o">==</span> <span class="n">nelem</span> <span class="p">:</span>
            <span class="n">el</span> <span class="o">=</span> <span class="s1">&#39;M&#39;</span>
            <span class="n">eelem</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;PARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">felem</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">eelem_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;PARAM_COV&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">felem_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM_COV&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">el</span> <span class="o">=</span> <span class="s1">&#39;alpha&#39;</span>
            <span class="n">eelem</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;PARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">felem</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">eelem_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;PARAM_COV&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
            <span class="n">felem_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM_COV&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">usemh</span> <span class="p">:</span>
                <span class="n">eelem</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">felem</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">usemh</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">usemh</span> <span class="p">):</span>
            <span class="n">refoffset</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">refoffset</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">usemh</span> <span class="p">:</span>
                <span class="n">refoffset</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="n">name</span><span class="o">=</span><span class="n">prefix</span><span class="o">+</span><span class="n">el</span>
        <span class="k">print</span> <span class="n">name</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;elem/&#39;</span><span class="o">+</span><span class="n">name</span>
        <span class="c1"># loop over plots</span>
        <span class="n">xtit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">iplot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span> <span class="p">:</span>
        <span class="c1">#for iplot in range(2,3) :</span>
            <span class="k">if</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>
              <span class="c1">#x = a[&#39;ELEM&#39;][gd,ifeh]</span>
              <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;X_H&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="n">ifeh</span><span class="p">]</span>
              <span class="n">xr</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.</span><span class="p">]</span>
              <span class="n">xt</span><span class="o">=</span> <span class="s1">&#39;[Fe/H] (cal)&#39;</span>
              <span class="n">y</span> <span class="o">=</span> <span class="n">eelem</span>
              <span class="k">if</span> <span class="ow">not</span> <span class="n">usemh</span><span class="p">:</span> <span class="n">y</span><span class="o">-=</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;PARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
              <span class="n">yr</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]</span>
              <span class="n">yt</span> <span class="o">=</span> <span class="s1">&#39;[&#39;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;/M](cal)&#39;</span>
              <span class="n">z</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
              <span class="n">zr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3000</span><span class="p">,</span><span class="n">tmax</span><span class="p">]</span>
              <span class="n">zt</span><span class="o">=</span><span class="s1">&#39;Teff&#39;</span>
              <span class="n">xtit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;calibrated vs [Fe/H]&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span>
              <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FELEM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="n">ifeh</span><span class="p">]</span>
              <span class="n">xr</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.</span><span class="p">]</span>
              <span class="n">xt</span><span class="o">=</span> <span class="s1">&#39;[Fe/H] (raw)&#39;</span>
              <span class="n">y</span> <span class="o">=</span> <span class="n">felem</span>
              <span class="k">if</span> <span class="ow">not</span> <span class="n">usemh</span><span class="p">:</span> <span class="n">y</span><span class="o">-=</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;PARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
              <span class="n">yr</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]</span>
              <span class="n">yt</span> <span class="o">=</span> <span class="s1">&#39;[&#39;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;/M](raw)&#39;</span>
              <span class="n">z</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
              <span class="n">zr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3000</span><span class="p">,</span><span class="n">tmax</span><span class="p">]</span>
              <span class="n">zt</span><span class="o">=</span><span class="s1">&#39;Teff&#39;</span>
              <span class="n">xtit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;raw vs [Fe/H]&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">:</span>
              <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
              <span class="n">xr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2500</span><span class="p">,</span><span class="n">tmax</span><span class="p">]</span>
              <span class="n">xt</span><span class="o">=</span> <span class="s1">&#39;Teff&#39;</span>
              <span class="n">y</span> <span class="o">=</span> <span class="n">eelem</span>
              <span class="k">if</span> <span class="ow">not</span> <span class="n">usemh</span><span class="p">:</span> <span class="n">y</span><span class="o">-=</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;PARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
              <span class="n">yr</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]</span>
              <span class="n">yt</span> <span class="o">=</span> <span class="s1">&#39;[&#39;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;/M](cal)&#39;</span>
              <span class="c1">#z = a[&#39;ELEM&#39;][gd,ifeh]</span>
              <span class="n">z</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;X_H&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="n">ifeh</span><span class="p">]</span>
              <span class="n">zr</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.</span><span class="p">]</span>
              <span class="n">zt</span><span class="o">=</span><span class="s1">&#39;[Fe/H]&#39;</span>
              <span class="n">xtit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;calibrated vs Teff&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">3</span> <span class="p">:</span>
              <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
              <span class="n">xr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2500</span><span class="p">,</span><span class="n">tmax</span><span class="p">]</span>
              <span class="n">xt</span><span class="o">=</span> <span class="s1">&#39;Teff&#39;</span>
              <span class="n">y</span> <span class="o">=</span> <span class="n">felem</span>
              <span class="k">if</span> <span class="ow">not</span> <span class="n">usemh</span><span class="p">:</span> <span class="n">y</span><span class="o">-=</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;PARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
              <span class="n">yr</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]</span>
              <span class="n">yt</span> <span class="o">=</span> <span class="s1">&#39;[&#39;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;/M](raw)&#39;</span>
              <span class="n">z</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FELEM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="n">ifeh</span><span class="p">]</span>
              <span class="n">zr</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.</span><span class="p">]</span>
              <span class="n">zt</span><span class="o">=</span><span class="s1">&#39;[Fe/H]&#39;</span>
              <span class="n">xtit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;raw vs Teff&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">4</span> <span class="p">:</span>
              <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
              <span class="n">xr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3000</span><span class="p">,</span><span class="n">tmax</span><span class="p">]</span>
              <span class="n">xt</span> <span class="o">=</span> <span class="s1">&#39;Teff&#39;</span>
              <span class="n">y</span> <span class="o">=</span> <span class="n">eelem</span><span class="o">-</span><span class="n">felem</span>
              <span class="n">yr</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.3</span><span class="p">]</span>
              <span class="n">yt</span> <span class="o">=</span> <span class="s1">&#39;cal - raw&#39;</span>
              <span class="n">z</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FELEM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="n">ifeh</span><span class="p">]</span>
              <span class="n">zr</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.</span><span class="p">]</span>
              <span class="n">zt</span><span class="o">=</span><span class="s1">&#39;[Fe/H]&#39;</span>
              <span class="n">xtit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;calibration&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">5</span> <span class="p">:</span>
              <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
              <span class="n">xr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2500</span><span class="p">,</span><span class="n">tmax</span><span class="p">]</span>
              <span class="n">xt</span> <span class="o">=</span> <span class="s1">&#39;Teff&#39;</span>
              <span class="n">y</span> <span class="o">=</span> <span class="n">eelem_err</span>
              <span class="n">yr</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.3</span><span class="p">]</span>
              <span class="n">yt</span> <span class="o">=</span> <span class="s1">&#39;Empirical uncertainty&#39;</span>
              <span class="n">z</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FELEM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="n">ifeh</span><span class="p">]</span>
              <span class="n">zr</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.</span><span class="p">]</span>
              <span class="n">zt</span><span class="o">=</span><span class="s1">&#39;[Fe/H]&#39;</span>
              <span class="n">xtit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;empirical uncertainty&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">6</span> <span class="p">:</span>
              <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
              <span class="n">xr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2500</span><span class="p">,</span><span class="n">tmax</span><span class="p">]</span>
              <span class="n">xt</span> <span class="o">=</span> <span class="s1">&#39;Teff&#39;</span>
              <span class="n">y</span> <span class="o">=</span> <span class="n">felem_err</span>
              <span class="n">yr</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.3</span><span class="p">]</span>
              <span class="n">yt</span> <span class="o">=</span> <span class="s1">&#39;FERRE uncertainty&#39;</span>
              <span class="n">z</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FELEM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="n">ifeh</span><span class="p">]</span>
              <span class="n">zr</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.</span><span class="p">]</span>
              <span class="n">zt</span><span class="o">=</span><span class="s1">&#39;[Fe/H]&#39;</span>
              <span class="n">xtit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;FERRE uncertainty&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">7</span> <span class="p">:</span>
              <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FPARAM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
              <span class="n">xr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2500</span><span class="p">,</span><span class="n">tmax</span><span class="p">]</span>
              <span class="n">xt</span> <span class="o">=</span> <span class="s1">&#39;Teff&#39;</span>
              <span class="k">if</span> <span class="n">ielem</span> <span class="o">&lt;</span> <span class="n">nelem</span> <span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;ELEM_CHI2&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="n">ielem</span><span class="p">]</span>
              <span class="k">else</span> <span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="mf">0.</span>
              <span class="n">yr</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">]</span>
              <span class="n">yt</span> <span class="o">=</span> <span class="s1">&#39;ELEM_CHI2&#39;</span>
              <span class="n">z</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;FELEM&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">,</span><span class="n">ifeh</span><span class="p">]</span>
              <span class="n">zr</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.</span><span class="p">]</span>
              <span class="n">zt</span><span class="o">=</span><span class="s1">&#39;[Fe/H]&#39;</span>
              <span class="n">xtit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;CHI2 from element fit&#39;</span><span class="p">)</span>
    
            <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fgrid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
                    <span class="n">plots</span><span class="o">.</span><span class="n">plotc</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">fgrid</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">fgrid</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">fgrid</span><span class="p">],</span><span class="n">xr</span><span class="o">=</span><span class="n">xr</span><span class="p">,</span><span class="n">yr</span><span class="o">=</span><span class="n">yr</span><span class="p">,</span><span class="n">zr</span><span class="o">=</span><span class="n">zr</span><span class="p">,</span><span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">yt</span><span class="o">=</span><span class="n">yt</span><span class="p">,</span><span class="n">xt</span><span class="o">=</span><span class="n">xt</span><span class="p">,</span><span class="n">zt</span><span class="o">=</span><span class="n">zt</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gkgrid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
                    <span class="n">plots</span><span class="o">.</span><span class="n">plotc</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">gkgrid</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">gkgrid</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">gkgrid</span><span class="p">],</span><span class="n">xr</span><span class="o">=</span><span class="n">xr</span><span class="p">,</span><span class="n">yr</span><span class="o">=</span><span class="n">yr</span><span class="p">,</span><span class="n">zr</span><span class="o">=</span><span class="n">zr</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">yt</span><span class="o">=</span><span class="n">yt</span><span class="p">,</span><span class="n">xt</span><span class="o">=</span><span class="n">xt</span><span class="p">,</span><span class="n">zt</span><span class="o">=</span><span class="n">zt</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mgrid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
                    <span class="n">plots</span><span class="o">.</span><span class="n">plotc</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">mgrid</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">mgrid</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">mgrid</span><span class="p">],</span><span class="n">xr</span><span class="o">=</span><span class="n">xr</span><span class="p">,</span><span class="n">yr</span><span class="o">=</span><span class="n">yr</span><span class="p">,</span><span class="n">zr</span><span class="o">=</span><span class="n">zr</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span><span class="n">yt</span><span class="o">=</span><span class="n">yt</span><span class="p">,</span><span class="n">xt</span><span class="o">=</span><span class="n">xt</span><span class="p">,</span><span class="n">zt</span><span class="o">=</span><span class="n">zt</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">iplot</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">iplot</span> <span class="o">==</span>  <span class="mi">2</span><span class="p">)</span> <span class="p">:</span> 
                <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="p">:</span>
                  <span class="n">clust</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;col3&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ielem</span><span class="p">)</span>
                  <span class="n">plots</span><span class="o">.</span><span class="n">plotp</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;col4&#39;</span><span class="p">][</span><span class="n">clust</span><span class="p">],</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;col9&#39;</span><span class="p">][</span><span class="n">clust</span><span class="p">],</span><span class="n">xr</span><span class="o">=</span><span class="n">xr</span><span class="p">,</span><span class="n">yr</span><span class="o">=</span><span class="n">yr</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">facecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># plot the reference star abundance (Arcturus or Vesta)</span>
                <span class="k">if</span> <span class="n">ielem</span> <span class="o">&lt;</span> <span class="n">nelem</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span>
                  <span class="c1">#refval = a[&#39;ELEM&#39;][ref,ielem]+refoffset</span>
                  <span class="c1">#referr = a[&#39;ELEM_ERR&#39;][ref,ielem]</span>
                  <span class="n">refval</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;X_M&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">,</span><span class="n">ielem</span><span class="p">]</span>
                  <span class="n">referr</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;X_M_ERR&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">,</span><span class="n">ielem</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">ielem</span> <span class="o">==</span> <span class="n">nelem</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span>
                  <span class="n">refval</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;PARAM&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">refoffset</span>
                  <span class="n">referr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;PARAM_COV&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
                <span class="k">else</span> <span class="p">:</span>
                  <span class="n">refval</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;PARAM&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="n">refoffset</span>
                  <span class="n">referr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;PARAM_COV&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">usemh</span><span class="p">:</span> <span class="n">refval</span> <span class="o">-=</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;PARAM&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">reflit</span> <span class="o">=</span> <span class="p">(</span><span class="n">refabun</span><span class="p">(</span><span class="n">el</span><span class="p">,</span><span class="n">dwarf</span><span class="o">=</span><span class="n">dwarf</span><span class="p">)</span><span class="o">-</span><span class="n">refabun</span><span class="p">(</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span><span class="n">dwarf</span><span class="o">=</span><span class="n">dwarf</span><span class="p">))</span>
                <span class="n">plots</span><span class="o">.</span><span class="n">plotl</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">xr</span><span class="p">,[</span><span class="n">refval</span><span class="o">-</span><span class="n">reflit</span><span class="p">,</span><span class="n">refval</span><span class="o">-</span><span class="n">reflit</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

                <span class="c1"># Plot the median of solar abundance stars</span>
                <span class="n">cal</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">solar</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">9000</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">solar</span><span class="p">[</span><span class="n">cal</span><span class="p">]])</span>
                <span class="n">plots</span><span class="o">.</span><span class="n">plotl</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">xr</span><span class="p">,[</span><span class="n">med</span><span class="p">,</span><span class="n">med</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="p">(</span><span class="n">xr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">yr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.85</span><span class="o">*</span><span class="p">(</span><span class="n">yr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;solar metallicity stars: {:4.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">med</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">el</span><span class="o">+</span><span class="s1">&#39;{:8.3f}  {:8d}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">med</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">cal</span><span class="p">)))</span>

                <span class="c1"># Plot the offset from the optical analysis </span>
                <span class="n">opt</span><span class="o">=</span><span class="n">optabun</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                <span class="n">plots</span><span class="o">.</span><span class="n">plotl</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">xr</span><span class="p">,[</span><span class="n">opt</span><span class="p">,</span><span class="n">opt</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="p">(</span><span class="n">xr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">yr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.75</span><span class="o">*</span><span class="p">(</span><span class="n">yr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;optical offset: {:4.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">opt</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>

                <span class="c1"># Plot M67 points</span>
                <span class="n">clust</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;../../cal/clust.fits&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
                <span class="n">m67</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">defchararray</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">clust</span><span class="p">[</span><span class="s1">&#39;FIELD&#39;</span><span class="p">],</span><span class="s1">&#39;M67&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">esutil</span><span class="o">.</span><span class="n">numpy_util</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;APOGEE_ID&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">],</span><span class="n">clust</span><span class="p">[</span><span class="s1">&#39;APOGEE_ID&#39;</span><span class="p">][</span><span class="n">m67</span><span class="p">])</span>
                <span class="n">plots</span><span class="o">.</span><span class="n">plotp</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">m1</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">m1</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">xr</span><span class="o">=</span><span class="n">xr</span><span class="p">,</span><span class="n">yr</span><span class="o">=</span><span class="n">yr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">:</span>
                    <span class="k">print</span> <span class="n">m1</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">m1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">dwarf</span> <span class="p">:</span> 
                    <span class="n">refstar</span> <span class="o">=</span> <span class="s1">&#39;VESTA&#39;</span>
                    <span class="k">if</span> <span class="n">dcal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="p">:</span> 
                        <span class="n">refclust</span><span class="o">=</span><span class="n">dcal</span><span class="p">[</span><span class="n">ielem</span><span class="p">]</span>  <span class="c1">#-dcal[ifeh]</span>
                        <span class="n">plots</span><span class="o">.</span><span class="n">plotl</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">xr</span><span class="p">,[</span><span class="n">refclust</span><span class="p">,</span><span class="n">refclust</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="p">(</span><span class="n">xr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">yr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.95</span><span class="o">*</span><span class="p">(</span><span class="n">yr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;M67 dwarfs: {:4.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">refclust</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="n">refstar</span> <span class="o">=</span> <span class="s1">&#39;Arcturus&#39;</span>
                    <span class="k">if</span> <span class="n">gcal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="p">:</span> 
                        <span class="n">refclust</span><span class="o">=</span><span class="n">gcal</span><span class="p">[</span><span class="n">ielem</span><span class="p">]</span>  <span class="c1">#-gcal[ifeh]</span>
                        <span class="n">plots</span><span class="o">.</span><span class="n">plotl</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">xr</span><span class="p">,[</span><span class="n">refclust</span><span class="p">,</span><span class="n">refclust</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="p">(</span><span class="n">xr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">yr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.95</span><span class="o">*</span><span class="p">(</span><span class="n">yr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;M67 giants: {:4.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">refclust</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">dcal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="p">:</span> 
                            <span class="n">drefclust</span><span class="o">=</span><span class="n">dcal</span><span class="p">[</span><span class="n">ielem</span><span class="p">]</span> <span class="c1">#-dcal[ifeh]</span>
                            <span class="n">plots</span><span class="o">.</span><span class="n">plotl</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">xr</span><span class="p">,[</span><span class="n">refclust</span><span class="o">-</span><span class="n">drefclust</span><span class="p">,</span><span class="n">refclust</span><span class="o">-</span><span class="n">drefclust</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="p">(</span><span class="n">xr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">yr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.90</span><span class="o">*</span><span class="p">(</span><span class="n">yr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;M67 dwarfs: {:4.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">drefclust</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="p">(</span><span class="n">xr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">yr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="p">(</span><span class="n">yr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="n">refstar</span><span class="o">+</span><span class="s1">&#39;   ASPCAP: {:4.2f}+/-{:4.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">refval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">referr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;   lit: &#39;</span><span class="o">+</span><span class="s1">&#39;{:4.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reflit</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

            <span class="c1">#plt.show()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="o">+</span><span class="s1">&#39;{:1d}.jpg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">iplot</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;{:1d}.jpg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">iplot</span><span class="p">))</span>

        <span class="n">ytit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="c1">#        plt.show()</span>
        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">html</span><span class="o">.</span><span class="n">htmltab</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="n">ytitle</span><span class="o">=</span><span class="n">ytit</span><span class="p">,</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;elem/&#39;</span><span class="o">+</span><span class="n">prefix</span><span class="o">+</span><span class="s1">&#39;elem.html&#39;</span><span class="p">,</span><span class="n">xtitle</span><span class="o">=</span><span class="n">xtit</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">tit</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="elemindex"><a class="viewcode-back" href="../../../elem.html#holtz.apogee.elem.elemindex">[docs]</a><span class="k">def</span> <span class="nf">elemindex</span><span class="p">()</span> <span class="p">:</span>
    <span class="sd">&#39;&#39;&#39; Make the HTML pages (assumes plots have already been made) for individual elements &#39;&#39;&#39;</span>

    <span class="n">a</span><span class="p">,</span><span class="n">elem</span><span class="p">,</span><span class="n">elemtoh</span> <span class="o">=</span> <span class="n">read</span><span class="p">()</span>

    <span class="c1"># loop over elements</span>
    <span class="n">nelem</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ielem</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="p">:</span>
      <span class="k">if</span> <span class="n">ielem</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="p">:</span>
          <span class="n">el</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="n">ielem</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
      <span class="k">elif</span> <span class="n">ielem</span> <span class="o">==</span> <span class="n">nelem</span> <span class="p">:</span>
            <span class="n">el</span> <span class="o">=</span> <span class="s1">&#39;M&#39;</span>
      <span class="k">elif</span> <span class="n">ielem</span> <span class="o">==</span> <span class="n">nelem</span><span class="o">+</span><span class="mi">1</span> <span class="p">:</span>
            <span class="n">el</span> <span class="o">=</span> <span class="s1">&#39;alpha&#39;</span>

      <span class="n">ytit</span><span class="o">=</span><span class="p">[]</span>
      <span class="n">files</span><span class="o">=</span><span class="p">[]</span>
      <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="p">[</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span> <span class="p">]</span> <span class="p">:</span>
       <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="p">[</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;gal&#39;</span> <span class="p">]</span> <span class="p">:</span>
        <span class="n">name</span><span class="o">=</span><span class="n">prefix</span><span class="o">+</span><span class="n">el</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="p">[</span><span class="n">prefix</span><span class="o">+</span><span class="s1">&#39;1mh&#39;</span><span class="o">+</span><span class="n">suffix</span><span class="o">+</span><span class="n">el</span><span class="o">+</span><span class="s1">&#39;2.jpg&#39;</span><span class="p">,</span><span class="n">prefix</span><span class="o">+</span><span class="s1">&#39;1emh&#39;</span><span class="o">+</span><span class="n">suffix</span><span class="o">+</span><span class="n">el</span><span class="o">+</span><span class="s1">&#39;2.jpg&#39;</span><span class="p">,</span><span class="n">prefix</span><span class="o">+</span><span class="s1">&#39;1eemh&#39;</span><span class="o">+</span><span class="n">suffix</span><span class="o">+</span><span class="n">el</span><span class="o">+</span><span class="s1">&#39;2.jpg&#39;</span><span class="p">,</span>
                <span class="n">prefix</span><span class="o">+</span><span class="s1">&#39;2mh&#39;</span><span class="o">+</span><span class="n">suffix</span><span class="o">+</span><span class="n">el</span><span class="o">+</span><span class="s1">&#39;2.jpg&#39;</span><span class="p">,</span><span class="n">prefix</span><span class="o">+</span><span class="s1">&#39;2emh&#39;</span><span class="o">+</span><span class="n">suffix</span><span class="o">+</span><span class="n">el</span><span class="o">+</span><span class="s1">&#39;2.jpg&#39;</span><span class="p">,</span><span class="n">prefix</span><span class="o">+</span><span class="s1">&#39;2eemh&#39;</span><span class="o">+</span><span class="n">suffix</span><span class="o">+</span><span class="n">el</span><span class="o">+</span><span class="s1">&#39;2.jpg&#39;</span><span class="p">,</span>
                <span class="n">prefix</span><span class="o">+</span><span class="s1">&#39;3mh&#39;</span><span class="o">+</span><span class="n">suffix</span><span class="o">+</span><span class="n">el</span><span class="o">+</span><span class="s1">&#39;2.jpg&#39;</span><span class="p">,</span><span class="n">prefix</span><span class="o">+</span><span class="s1">&#39;3emh&#39;</span><span class="o">+</span><span class="n">suffix</span><span class="o">+</span><span class="n">el</span><span class="o">+</span><span class="s1">&#39;2.jpg&#39;</span><span class="p">,</span><span class="n">prefix</span><span class="o">+</span><span class="s1">&#39;3eemh&#39;</span><span class="o">+</span><span class="n">suffix</span><span class="o">+</span><span class="n">el</span><span class="o">+</span><span class="s1">&#39;2.jpg&#39;</span><span class="p">]</span>
        <span class="n">xtit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Linear 4000-5250&#39;</span><span class="p">,</span><span class="s1">&#39;Linear 3750-5250&#39;</span><span class="p">,</span><span class="s1">&#39;Linear 3500-5250&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Quadratic 4000-5250&#39;</span><span class="p">,</span><span class="s1">&#39;Quadratic 3750-5250&#39;</span><span class="p">,</span><span class="s1">&#39;Quadratic 3500-5250&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Cubic 4000-5250&#39;</span><span class="p">,</span><span class="s1">&#39;Cubic 3750-5250&#39;</span><span class="p">,</span><span class="s1">&#39;Cubic 3500-5250&#39;</span><span class="p">]</span>
        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>

      <span class="n">ytit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Giants (full)&#39;</span><span class="p">,</span><span class="s1">&#39;Giants (70&amp;lt;l&amp;lt;110)&#39;</span><span class="p">,</span><span class="s1">&#39;Dwarfs (full)&#39;</span><span class="p">,</span><span class="s1">&#39;Dwarfs (70&amp;lt;l&amp;lt;110)&#39;</span><span class="p">]</span>
      <span class="n">html</span><span class="o">.</span><span class="n">htmltab</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;elem/&#39;</span><span class="o">+</span><span class="n">el</span><span class="o">+</span><span class="s1">&#39;.html&#39;</span><span class="p">,</span><span class="n">xtitle</span><span class="o">=</span><span class="n">xtit</span><span class="p">,</span><span class="n">ytitle</span><span class="o">=</span><span class="n">ytit</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../../elem.html#holtz.apogee.elem.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="p">:</span>
    <span class="sd">&#39;&#39;&#39; Make series of plots and web pages for each calibration &quot;type&quot; &#39;&#39;&#39;</span>    

    <span class="c1">#files = [&#39;testcal&#39;,&#39;testcal1mh&#39;,&#39;testcal2mh&#39;,&#39;testcal3mh&#39;,</span>
    <span class="c1">#         &#39;testcal1emh&#39;,&#39;testcal2emh&#39;,&#39;testcal3emh&#39;, </span>
    <span class="c1">#         &#39;testcal1eemh&#39;,&#39;testcal2eemh&#39;,&#39;testcal3eemh&#39;] </span>
    <span class="c1">#dirs = [&#39;../testcal&#39;,&#39;testcal1mh&#39;,&#39;testcal2mh&#39;,&#39;testcal3mh&#39;,</span>
    <span class="c1">#         &#39;testcal1emh&#39;,&#39;testcal2emh&#39;,&#39;testcal3emh&#39;, </span>
    <span class="c1">#         &#39;testcal1eemh&#39;,&#39;testcal2eemh&#39;,&#39;testcal3eemh&#39;] </span>
    <span class="c1">#suffixes = [&#39;&#39;,&#39;1mh&#39;,&#39;2mh&#39;,&#39;3mh&#39;,&#39;1emh&#39;,&#39;2emh&#39;,&#39;3emh&#39;,&#39;1eemh&#39;,&#39;2eemh&#39;,&#39;3eemh&#39;]</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;l30e.2&#39;</span><span class="p">]</span>
    <span class="n">dirs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;../cal&#39;</span><span class="p">]</span>
    <span class="n">suffixes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">))</span> <span class="p">:</span>
      <span class="n">a</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">etoh</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;allStar-&#39;</span><span class="o">+</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.fits&#39;</span><span class="p">)</span>
      <span class="n">gcal</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/giantcal.fits&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ABUN&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">17</span><span class="p">]</span>
      <span class="n">dcal</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/dwarfcal.fits&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ABUN&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">17</span><span class="p">]</span>
      <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span> <span class="p">]</span> <span class="p">:</span>
        <span class="k">if</span> <span class="n">d</span> <span class="p">:</span>
          <span class="n">res</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/dwarfcal.res&#39;</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
          <span class="n">res</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/giantcal.res&#39;</span><span class="p">)</span>
        <span class="n">tmp</span><span class="o">=</span><span class="n">etoh</span>   <span class="c1"># since etoh gets changed for dwarfs</span>
        <span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">suffix</span><span class="o">=</span><span class="n">suffixes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">dwarf</span><span class="o">=</span><span class="n">d</span><span class="p">,</span><span class="n">gcal</span><span class="o">=</span><span class="n">gcal</span><span class="p">,</span><span class="n">dcal</span><span class="o">=</span><span class="n">dcal</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">usemh</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">sn</span><span class="o">=</span><span class="p">[</span><span class="mi">200</span><span class="p">,</span><span class="mi">1000</span><span class="p">])</span>
        <span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">suffix</span><span class="o">=</span><span class="n">suffixes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;gal&#39;</span><span class="p">,</span><span class="n">dwarf</span><span class="o">=</span><span class="n">d</span><span class="p">,</span><span class="n">gcal</span><span class="o">=</span><span class="n">gcal</span><span class="p">,</span><span class="n">dcal</span><span class="o">=</span><span class="n">dcal</span><span class="p">,</span><span class="n">glon</span><span class="o">=</span><span class="p">[</span><span class="mi">70</span><span class="p">,</span><span class="mi">110</span><span class="p">],</span><span class="n">glat</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="n">res</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">usemh</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c1">#a,e,etoh = read()</span>
    <span class="c1">#plot(a,e,etoh)</span>
    <span class="c1">#plot(a,e,etoh,dwarf=True)</span>
</div>
<div class="viewcode-block" id="globalscatter"><a class="viewcode-back" href="../../../elem.html#holtz.apogee.elem.globalscatter">[docs]</a><span class="k">def</span> <span class="nf">globalscatter</span><span class="p">(</span><span class="n">allstar</span><span class="p">,</span><span class="n">elems</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Compute scatter in clusters</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">clust</span><span class="o">=</span><span class="n">apselect</span><span class="o">.</span><span class="n">clustdata</span><span class="p">()</span>
    <span class="n">gd</span><span class="o">=</span><span class="n">apselect</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">allstar</span><span class="p">,</span><span class="n">badval</span><span class="o">=</span><span class="s1">&#39;STAR_BAD&#39;</span><span class="p">)</span>
    <span class="n">members</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">print</span> <span class="s1">&#39;selecting&#39;</span>
    <span class="n">clusts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;N2420&#39;</span><span class="p">,</span> <span class="s1">&#39;M67&#39;</span><span class="p">,</span> <span class="s1">&#39;N188&#39;</span><span class="p">,</span> <span class="s1">&#39;N7789&#39;</span><span class="p">,</span> <span class="s1">&#39;N6819&#39;</span><span class="p">,</span> <span class="s1">&#39;N6791&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">clusts</span> <span class="p">:</span>
        <span class="n">j</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">apselect</span><span class="o">.</span><span class="n">clustmember</span><span class="p">(</span><span class="n">allstar</span><span class="p">[</span><span class="n">gd</span><span class="p">],</span><span class="n">cluster</span><span class="p">,</span><span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="k">print</span> <span class="n">cluster</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
    <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>

    <span class="n">iel</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elems</span><span class="p">,[</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span> <span class="p">:</span>
        <span class="n">iclust</span><span class="o">=</span><span class="mi">0</span>
        <span class="nb">all</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">clusts</span> <span class="p">:</span>
            <span class="n">i</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">clust</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">cluster</span><span class="p">)</span>
            <span class="n">mh</span><span class="o">=</span><span class="n">clust</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">mh</span>
            <span class="n">name</span><span class="o">=</span><span class="n">clust</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
            <span class="c1"># get cluster members</span>
            <span class="n">j</span><span class="o">=</span><span class="n">members</span><span class="p">[</span><span class="n">iclust</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Fe&#39;</span> <span class="p">:</span>
                  <span class="n">abun</span><span class="o">=</span><span class="n">allstar</span><span class="p">[</span><span class="s1">&#39;X_H&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">iel</span><span class="p">]</span>
                  <span class="n">ok</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(((</span><span class="n">allstar</span><span class="p">[</span><span class="s1">&#39;ELEMFLAG&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">iel</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">255</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">allstar</span><span class="p">[</span><span class="s1">&#39;X_H_ERR&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">iel</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">el</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span> <span class="p">:</span>
                  <span class="n">abun</span><span class="o">=</span><span class="n">allstar</span><span class="p">[</span><span class="s1">&#39;M_H&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
                  <span class="n">ok</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(((</span><span class="n">allstar</span><span class="p">[</span><span class="s1">&#39;PARAMFLAG&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">255</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">allstar</span><span class="p">[</span><span class="s1">&#39;M_H_ERR&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">el</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;alpha&#39;</span> <span class="p">:</span>
                  <span class="n">abun</span><span class="o">=</span><span class="n">allstar</span><span class="p">[</span><span class="s1">&#39;ALPHA_M&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
                  <span class="n">ok</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(((</span><span class="n">allstar</span><span class="p">[</span><span class="s1">&#39;PARAMFLAG&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="mi">6</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">255</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">allstar</span><span class="p">[</span><span class="s1">&#39;ALPHA_M_ERR&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span> <span class="p">:</span>
                  <span class="n">abun</span><span class="o">=</span><span class="n">allstar</span><span class="p">[</span><span class="s1">&#39;X_M&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">iel</span><span class="p">]</span>
                  <span class="n">ok</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(((</span><span class="n">allstar</span><span class="p">[</span><span class="s1">&#39;ELEMFLAG&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">iel</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">255</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">allstar</span><span class="p">[</span><span class="s1">&#39;X_M_ERR&#39;</span><span class="p">][</span><span class="n">gd</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">iel</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ok</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="p">:</span>
                    <span class="nb">all</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">all</span><span class="p">,</span><span class="n">abun</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span><span class="o">-</span><span class="n">abun</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
            <span class="n">iclust</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">print</span> <span class="n">el</span><span class="p">,</span> <span class="nb">all</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="nb">all</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span>
        <span class="n">iel</span><span class="o">+=</span><span class="mi">1</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span> <span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">apogee 0.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Jon Holtzman.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>